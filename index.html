/*** GAS 片段（加入到你的 doPost 控制器內） ***/
// 建議：在活頁簿新增名為 "layout" 的工作表，A欄: key, B欄: json
function getLayoutSheet_() {
  const ss = SpreadsheetApp.openById(SpreadsheetApp.getActive().getId());
  const sh = ss.getSheetByName('layout') || ss.insertSheet('layout');
  return sh;
}
function readLayout_() {
  const sh = getLayoutSheet_();
  const values = sh.getDataRange().getValues(); // [[key, json], ...]
  for (let i=0;i<values.length;i++) {
    if (values[i][0] === 'layout_v1') {
      try { return JSON.parse(values[i][1]); } catch(e) { return null; }
    }
  }
  return null;
}
function writeLayout_(obj) {
  const sh = getLayoutSheet_();
  const data = sh.getDataRange().getValues();
  let row = -1;
  for (let i=0;i<data.length;i++) if (data[i][0] === 'layout_v1') { row = i+1; break; }
  const json = JSON.stringify(obj);
  if (row === -1) {
    sh.appendRow(['layout_v1', json, new Date()]);
  } else {
    sh.getRange(row, 2).setValue(json);
    sh.getRange(row, 3).setValue(new Date());
  }
}

// 在 doPost(e) 裡面加：
// case 'getLayout': return json({ ok:true, layout: readLayout_() || { locked:false, cells:[], pos:{} } });
// case 'saveLayout': writeLayout_(payload.layout); return json({ ok:true });

/*** 你的 json() 是回傳 JSON 的工具，確保回傳 ContentService.createTextOutput(JSON.stringify(...)).setMimeType(ContentService.MimeType.JSON);
 */
